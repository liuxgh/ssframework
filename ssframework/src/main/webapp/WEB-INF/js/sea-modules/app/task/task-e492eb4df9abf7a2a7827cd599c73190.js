define("app/task/task",["../common/jquery.pjax","gallery/My97DatePicker/WdatePicker.js","../blui/ui-show","../blui/ui-dialog","gallery/jquery/jquery-1.10.2.min.js","../base/class","gallery/template/template.min","./taskTemplate","./caseInfo","../common/file","../common/table","../common/loading"],function(require,exports,module){require("../common/jquery.pjax");var WdatePicker=require("gallery/My97DatePicker/WdatePicker.js"),Show=require("../blui/ui-show"),BLUIDialog=require("../blui/ui-dialog"),TaskTemplate=require("./taskTemplate"),Case=require("./caseInfo"),File=require("../common/file"),Table=require("../common/table"),cancelBtnClass=".modal-f-cancelBtn",Template=require("gallery/template/template.min"),Loading=require("../common/loading");exports.run=function(){var a=$(".b-tasks").attr("data-process");menu(a),todoTask(),File.run(),Table.list(),operation(),configure()};var menu=function(a){showProcessTasks($("li[data-type="+a+"]"),a,$(".b-tasks").attr("data-task"),"load"),loading(a),Case.html();var b=$(".b-t-item h2"),c=".b-t-item li";b.click(function(){var a=$(this).parents(".b-t-item");a.addClass("f-selected").siblings().removeClass("f-selected");var b=a.attr("data-type");showProcessTasks(a,b)}),$("body").delegate(c,"click",function(){$(this).addClass("c-selected").siblings().removeClass("c-selected");var a=$.trim($(this).parents(".b-t-item").attr("data-type"));loading(a),Case.html()}),$.pjax({selector:c,container:".b-taskContent",requestType:"link",show:"_default",cache:!1,storage:!1,titleSuffix:"任务管理 - 业务系统管理平台",filter:function(){},callback:function(){},template:function(){}})},showProcessTasks=function(obj,process,task,type){var url="/menuTask",menuTaskTemplateId="task-menuTask";Loading(obj.find("ul"),url,{process:process,task:task},function(data,element){data=eval(data);var html=Template(menuTaskTemplateId,data);$(element).html(html),"load"!=type&&$(element).find("li:first").click()})},operation=function(){$("body").delegate(".passBtn","click",function(){var a="确认文件无误？可以通过审核？",b=$.trim($(this).attr("data-id"));Show.show(a,b,function(a){$("body").delegate(".modal-f-submitBtn","click",function(){}),$("body").delegate(".modal-f-cancelBtn","click",function(){a.close()})})}),lightBox(".notPassBtn","click","ajax",function(){}),lightBox(".t-h-addBtn","click","ajax",function(){}),$("body").delegate(".Wdate","focus",function(){WdatePicker({readOnly:!0})}),lightBox(".agent","click","iframe",function(){}),lightBox("#auditor","focus","iframe",function(){}),lightBox("#process","focus","iframe",function(){}),lightBox(".exchangeAgentBtn","click","ajax",function(){}),lightBox(".exchangeCustomerBtn","click","ajax",function(){}),lightBox(".addAttachFileBtn","click","ajax",function(){})},configure=function(){lightBox(".addCostBtn","click","ajax",function(){})},todoTask=function(){$("body").delegate(".t-t-ol-item","mouseover",function(){$(this).find(".ol-opBtn").css({display:"inline-block"})}).delegate(".t-t-ol-item","mouseout",function(){$(this).find(".ol-opBtn").css({display:"none"})}),$("body").delegate(".ol-opBtn","click",function(){var a=$.trim($(this).parent().find("em").text());$(this).parent().hide(),$(this).parent().next().show(),$(this).parent().next().find("input[type='text']").val(a)}),$("body").delegate(".ol-sureBtn","click",function(){var a=$.trim($(this).parent().find("input[type='text']").val());$(this).parents(".edit").hide(),$(this).parents(".edit").prev().show(),$(this).parents(".edit").prev().find("em").html(a)}),tabChange(".t-t-tab-sec li",".t-t-filebj","selected"),tabChange(".t-t-tab li",".task-todo-item","selected")},tabChange=function(a,b,c){$("body").delegate(a,"click",function(){$(this).addClass(c).siblings().removeClass(c);var d=$(a).index($(this));$(b).eq(d).removeClass("dn").siblings(b).addClass("dn")})},lightBox=function(a,b,c,d){$("body").delegate(a,b,function(){var a=$.trim($(this).attr("data-winWidth")),b=$.trim($(this).attr("data-winHeight")),e=$.trim($(this).attr("data-url"));if("ajax"===c){new BLUIDialog({width:a,height:b}).openajax(e+"?t="+(new Date).getMilliseconds(),function(a){$("body").delegate(cancelBtnClass,"click",function(){a.close()}),$("body").delegate("","click",function(){"function"==typeof d&&d(a)})})}else if("iframe"===c){new BLUIDialog({width:a,height:b}).openIframe(e,function(a){$("body").delegate(cancelBtnClass,"click",function(){a.close()}),$("body").delegate("","click",function(){"function"==typeof d&&d(a)})})}})},loading=function(a){var b=$(".b-taskContent"),c=TaskTemplate.taskInfo(a),d=TaskTemplate.taskToDo(a),e=TaskTemplate.history(),f=TaskTemplate.noticePreview(),g=TaskTemplate.caseToDo(),h=TaskTemplate.notice(a),i=TaskTemplate.configure(),j=TaskTemplate.timeAllocation(),k=TaskTemplate.button(a);"applyFile"===a?b.html(c+d+k+e):"correction"===a?b.html(c+f+d+k+e):"opinion"===a?b.html(c+f+d+k+e):"caser"===a?b.html(c+g+e):"adviceProcessing"===a?b.html(c+h+f+d+k+e):"customerFile"===a?b.html(c+h+d+k+e):"noticeDefinition"===a?b.html(c+f+i+j):"additionalFile"===a&&b.html(c+h+d+k)}}),define("app/common/jquery.pjax",["gallery/jquery/jquery-1.10.2.min.js"],function(a,b,c){a("gallery/jquery/jquery-1.10.2.min.js"),function(a){var b={support:{pjax:window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/(iPod|iPhone|iPad|WebApps\/.+CFNetwork)/),storage:!!window.localStorage},toInt:function(a){return parseInt(a)},stack:{},getTime:function(){return 1*new Date},getRealUrl:function(a){return a=(a||"").replace(/\#.*?$/,""),a=a.replace("?pjax=true&","?").replace("?pjax=true","").replace("&pjax=true","")},getUrlHash:function(a){return a.replace(/^[^\#]*(?:\#(.*?))?$/,"$1")},getLocalKey:function(a){var b="pjax_"+encodeURIComponent(a);return{data:b+"_data",time:b+"_time",title:b+"_title"}},removeAllCache:function(){if(b.support.storage)for(var a in localStorage)"pjax"===(a.split("_")||[""])[0]&&delete localStorage[a]},getCache:function(a,c,d){var e,f,g,h;if(c=b.toInt(c),a in b.stack){if(e=b.stack[a],ctime=b.getTime(),e.time+1e3*c>ctime)return e;delete b.stack[a]}else if(d&&b.support.storage){var i=b.getLocalKey(a);if(f=i.data,g=i.time,e=localStorage.getItem(f)){if(h=b.toInt(localStorage.getItem(g)),h+1e3*c>b.getTime())return{data:e,title:localStorage.getItem(i.title)};localStorage.removeItem(f),localStorage.removeItem(g),localStorage.removeItem(i.title)}}return null},setCache:function(a,c,d,e){var f,g=b.getTime();b.stack[a]={data:c,title:d,time:g},e&&b.support.storage&&(f=b.getLocalKey(a),localStorage.setItem(f.data,c),localStorage.setItem(f.time,g),localStorage.setItem(f.title,d))},removeCache:function(a){if(a=b.getRealUrl(a||location.href),delete b.stack[a],b.support.storage){var c=b.getLocalKey(a);localStorage.removeItem(c.data),localStorage.removeItem(c.time),localStorage.removeItem(c.title)}}},c=function(d){if(d=a.extend({selector:"",container:"",requestType:"",callback:function(){},filter:function(){},template:function(){}},d),!d.container||!d.selector)throw new Error("selector & container options must be set");"form"===d.requestType?a("body").delegate(d.selector,"submit",function(e){if(e.which>1||e.metaKey)return!0;var f=a(this),g=f.attr("action")+"?"+f.serialize();if("function"==typeof d.filter&&d.filter.call(this,g,this)===!0)return!0;if(g===location.href)return!0;if(b.getRealUrl(g)==b.getRealUrl(location.href)){var h=b.getUrlHash(g);return h&&(location.hash=h,d.callback&&d.callback.call(this,{type:"hash"})),!0}return e.preventDefault(),d=a.extend(!0,d,{url:g,element:this,title:"",push:!0}),c.request(d),!1}):a("body").delegate(d.selector,"click",function(e){if(e.which>1||e.metaKey)return!0;var f=a(this),g=f.attr("data-href");if("function"==typeof d.filter&&d.filter.call(this,g,this)===!0)return!0;if(g===location.href)return!0;if(b.getRealUrl(g)==b.getRealUrl(location.href)){var h=b.getUrlHash(g);return h&&(location.hash=h,d.callback&&d.callback.call(this,{type:"hash"})),!0}e.preventDefault(),d=a.extend(!0,d,{url:g,element:this,title:"",push:!0}),c.request(d)})};c.xhr=null,c.options={},c.state={},c.defaultOptions={timeout:2e3,element:null,cache:86400,storage:!0,url:"",push:!0,show:"",title:"",titleSuffix:"",type:"GET",data:{pjax:!0},dataType:"html",callback:null,beforeSend:function(b){a(c.options.container).trigger("pjax.start",[b,c.options]),b&&b.setRequestHeader("X-PJAX",!0)},error:function(){c.options.callback&&c.options.callback.call(c.options.element,{type:"error"}),location.href=c.options.url},complete:function(b){a(c.options.container).trigger("pjax.end",[b,c.options])}},c.showFx={_default:function(a,b,d){this.html(c.template(a)),b&&b.call(this,a,d)},fade:function(a,b,d){var e=this;d?(e.html(c.template(a)),b&&b.call(e,a,d)):this.fadeOut(500,function(){e.html(c.template(a)).fadeIn(500,function(){b&&b.call(e,a,d)})})}},c.showFn=function(b,d,e,f,g){var h=null;"function"==typeof b?h=b:(b in c.showFx||(b="_default"),h=c.showFx[b]),h&&h.call(d,e,function(){var b=location.hash;""!=b?(location.href=b,/Firefox/.test(navigator.userAgent)&&history.replaceState(a.extend({},c.state,{url:null}),document.title)):window.scrollTo(0,0),f&&f.call(this,e,g)},g)},c.success=function(d,e){if(e!==!0&&(e=!1),c.html&&(d=a(d).find(c.html).html()),-1!=(d||"").indexOf("<html"))return c.options.callback&&c.options.callback.call(c.options.element,{type:"error"}),location.href=c.options.url,!1;var f,g=c.options.title||"";c.options.element&&(f=a(c.options.element),g=f.attr("title")||f.text());var h=d.match(/<title>(.*?)<\/title>/);h&&(g=h[1]),g&&-1==g.indexOf(c.options.titleSuffix)&&(g+=c.options.titleSuffix),document.title=c.options.titleSuffix,c.state={container:c.options.container,timeout:c.options.timeout,cache:c.options.cache,storage:c.options.storage,show:c.options.show,title:g,url:c.options.oldUrl};var i=a.param(c.options.data);""!=i&&(c.state.url=c.options.url+(/\?/.test(c.options.url)?"&":"?")+i),c.options.push?(c.active||(history.replaceState(a.extend({},c.state,{url:null}),document.title),c.active=!0),history.pushState(c.state,document.title,c.options.oldUrl)):c.options.push===!1&&history.replaceState(c.state,document.title,c.options.oldUrl),c.options.showFn&&c.options.showFn(d,function(){c.options.callback&&c.options.callback.call(c.options.element,{type:e?"cache":"success"})},e),c.options.cache&&!e&&b.setCache(c.options.url,d,g,c.options.storage)},c.request=function(d){d=a.extend(!0,c.defaultOptions,d);var e,f=a(d.container);return d.oldUrl=d.url,d.url=b.getRealUrl(d.url),a(d.element).length&&(e=b.toInt(a(d.element).attr("data-pjax-cache")),e&&(d.cache=e)),d.cache===!0&&(d.cache=86400),d.cache=b.toInt(d.cache),0===d.cache&&b.removeAllCache(),d.showFn||(d.showFn=function(a,b,e){c.showFn(d.show,f,a,b,e)}),c.options=d,c.options.success=c.success,d.cache&&(e=b.getCache(d.url,d.cache,d.storage))?(d.beforeSend(),d.title=e.title,c.success(e.data,!0),d.complete(),!0):(c.xhr&&c.xhr.readyState<4&&(c.xhr.onreadystatechange=a.noop,c.xhr.abort()),void(c.xhr=a.ajax(c.options)))},c.template=function(a){c.options.template(a,c.options.container)};var d="state"in window.history,e=location.href;a(window).bind("popstate",function(b){var f=!d&&location.href==e;if(d=!0,!f){var g=b.state;if(g&&g.container)if(a(g.container).length){var h={url:g.url,container:g.container,push:null,timeout:g.timeout,cache:g.cache,storage:g.storage,title:g.title,element:null};c.request(h)}else window.location=location.href}}),b.support.pjax||(c=function(){return!0},c.request=function(a){a&&a.url&&(location.href=a.url)}),a.pjax=c,a.pjax.util=b,a.inArray("state",a.event.props)<0&&a.event.props.push("state")}(jQuery),c.exports=$}),define("app/blui/ui-show",["app/blui/ui-dialog","gallery/jquery/jquery-1.10.2.min.js","app/base/class","gallery/template/template.min"],function(a,b){var c=a("app/blui/ui-dialog"),d=a("gallery/template/template.min");b.show=function(a,b){{var e="common-tips",f=470,g=180,h={mes:a,isBtnShow:!1},i=d(e,h);new c({width:f,height:g}).open(i,function(a){"function"==typeof b&&b(a)})}}}),define("app/blui/ui-dialog",["gallery/jquery/jquery-1.10.2.min.js","app/base/class"],function(a,b,c){a("gallery/jquery/jquery-1.10.2.min.js");var d=a("app/base/class"),e=new d({init:function(a){this.w=a&&a.width||this.settting.width,this.h=a&&a.height||this.settting.height,this.isBg=this.settting.isBg,a&&"boolean"==typeof a.isBg&&(this.isBg=a.isBg),this.errorMsg=a&&a.errorMsg||this.settting.errorMsg;var b="position:fixed;",c=$(window).height();this.h>c&&(b="position:absolute;");var d='<div class="modal-win" style="'+b+"width:"+this.w+"px;height:"+this.h+'px;"><div class="modal-close" title="关闭"></div><div class="modal-content"></div></div>';return this.isBg&&(d='<div class="modal-bg"></div>'+d),this.close(),$("body").append(d),this.position().closeClick().reisze(),this},settting:{width:200,height:200,errorMsg:"非常抱歉，请求出错 ; )",appendDom:$("body"),defaultMsg:"您好，你可以添加自己的内容",isBg:!0},open:function(a,b){return"string"!=typeof a&&(b=a,a=this.settting.defaultMsg),this.dhtml(a,b),this},openajax:function(a,b){var c='<img class="modal-loading" src="/images/blui/loading.gif" />',d="缺少url引用",e=this;return"string"==typeof a?(e.dhtml(c).position(),$.ajax({url:a,type:"post",success:function(a){e.dhtml(a,b)},error:function(){e.dhtml(e.errorMsg)}})):e.dhtml(d),this},openIframe:function(a,b){var c='<img class="modal-loading" src="/images/blui/loading.gif" />',d="缺少url引用",e=this,f="";return"string"==typeof a?(e.dhtml(c).position(),f="<iframe src='"+a+"' style='width:"+this.w+"px;height:"+this.h+"px;border:none;'></iframe>",e.dhtml(f,b)):e.dhtml(d),this},dhtml:function(a,b){return $(".modal-content").html(a),"function"==typeof b&&b(this),this},closeClick:function(){var a=this;return $("body").delegate(".modal-close","click",function(){a.close()}),this},close:function(){var a=$("body");a.children("div.modal-bg").remove(),a.children("div.modal-win").remove()},showMsg:function(a,b,c){{var d="modal-success-icon",e="我是默认的消息提示",f=arguments[0]||1;arguments.length}"number"!=typeof f&&(c=b,b=f,f=1),"function"==typeof b&&(c=b),"number"==typeof f&&(2==f&&(d="modal-warn-icon"),3==f&&(d="modal-error-icon"));var g="<div class='modal-msg "+d+"'>"+e+"</div>";this.dhtml(g),"function"==typeof c&&c()},position:function(){var a=$(window),b=a.width(),c=a.height(),d=(c-this.h)/2,e=(b-this.w)/2;return 0>=d&&(d=10),0>=e&&(e=10),$(".modal-win").css({top:d,left:e+"px"}),$(".modal-win .modal-loading").css({top:this.h/2-32+"px",left:this.w/2-32+"px"}),this},reisze:function(){var a=this;$(window).bind("resize",function(){a.position()})}});c.exports=e}),define("app/base/class",[],function(a,b,c){function d(a,b){function c(a){var c=e(a)?a.prototype:a;for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d])}if(h(a)){var d,f;for(d=0,f=a.length;f>d;d++)c(a[d])}else c(a)}function e(a){return"[object Function]"===g.call(a)}var f=function(a,b){e(a)||(b=a,a=null);var c=function(){this.init&&c.prototype.hasOwnProperty("init")&&this.init.apply(this,arguments),this.include&&c.prototype.hasOwnProperty("include")&&d(this.include,c.prototype)};if(a){var g=function(){};g.prototype=a.prototype,c.prototype=new g,c.prototype.constructor=c,c._super=a.prototype}return c.include=function(a){for(var b in a)a.hasOwnProperty(b)&&(c.prototype[b]=a[b])},b&&c.include(b),c.extend=function(a){return new f(c,a)},c},g=Object.prototype.toString,h=Array.isArray||function(a){return"[object Array]"===g.call(a)};c.exports=f}),define("app/task/taskTemplate",["gallery/jquery/jquery-1.10.2.min.js","gallery/template/template.min"],function(a,b){a("gallery/jquery/jquery-1.10.2.min.js");var c=a("gallery/template/template.min"),d="task-taskInfo",e="task-toDoTask",f="task-history",g="file-file",h="task-noticePreview",i="task-caseToDo",j="task-notice",k="task-configure",l="task-timeAllocation",m="task-button";b.taskInfo=function(a){var b="";"applyFile"===a?b="申请文件审核":"correction"===a?b="补正审核":"opinion"===a?b="审查意见答复审查":"caser"===a?b="案件人员分配":"adviceProcessing"===a?b="其它通知书处理":"customerFile"===a?b="客户打回文件处理":"noticeDefinition"===a?b="其它通知书定义":"additionalFile"===a?b="附加文件处理":"detail"===a&&(b="任务查询 > AJ-23231-201409");var e={title:b};return c(d,e)},b.taskToDo=function(a){var b="",d="info";"applyFile"===a||"correction"===a||"opinion"===a||"adviceProcessing"===a||"customerFile"===a?b="examine":"additionalFile"===a?b="edit":"detail"===a&&(b="readOnly");var f={type:a,auditFile:[{type:b},{type:b}],fileInfo:[{type:d}]};return c(e,f)},b.history=function(a){"undefined"==typeof a&&(a=!0);var b={buttonIsShow:a};return c(f,b)},b.file=function(a){var b={type:a};return c(g,b)},b.noticePreview=function(){var a={};return c(h,a)},b.caseToDo=function(){var a={};return c(i,a)},b.notice=function(a){var b="",d="";"adviceProcessing"===a?(b="通知书名称",d="【视为撤回通知书】"):"customerFile"===a?(b="客户打回理由",d="【写的文件不符合我的要求，需要将这个那个地方改一改】"):"additionalFile"===a?(b="任务信息",d="taskInfo"):"detail"===a&&(b="完成时间",d="【2014-09-21 10:20】");var e={title:b,text:d};return c(j,e)},b.configure=function(){var a={};return c(k,a)},b.timeAllocation=function(){var a={};return c(l,a)},b.button=function(a){var b={type:a};return c(m,b)}}),define("app/task/caseInfo",["gallery/jquery/jquery-1.10.2.min.js","gallery/template/template.min"],function(a,b){a("gallery/jquery/jquery-1.10.2.min.js");var c="task-caseInfo",d="task-agent",e="task-customer",f="task-contact",g="task-caseProcess",h=a("gallery/template/template.min");b.html=function(){var a=b.caseInfo(),c=b.agent(),d=b.customer(),e=b.contact(),f=b.caseProcess();$(".b-taskInfo").html(a+c+d+e+f)},b.caseInfo=function(){var a={};return h(c,a)},b.agent=function(){var a={};return h(d,a)},b.customer=function(){var a={};return h(e,a)},b.contact=function(){var a={};return h(f,a)},b.caseProcess=function(){var a={};return h(g,a)}}),define("app/common/file",["gallery/jquery/jquery-1.10.2.min.js","gallery/template/template.min","app/blui/ui-dialog","app/base/class"],function(a,b){a("gallery/jquery/jquery-1.10.2.min.js");var c=a("gallery/template/template.min"),d="file-fileOp",e=a("app/blui/ui-dialog");b.run=function(){var a=($(".t-t-f-item"),".modal-f-cancelBtn");$("body").delegate(".t-t-f-item","mouseover",function(){$(".fileOperation").remove();var a=$.trim($(this).attr("data-type")),b=$(this).offset(),e=b.top-28,f={fileId:"1",downloadUrl:"http://www.baidu.com/",left:b.left+"px",top:e+"px",type:a},g=c(d,f);$("body").append(g)}),$(document).click(function(a){$(a.target).parents(".fileOperation").length>0||$(a.target).parents(".t-t-f-item").length>0||$(".fileOperation").remove()}),$("body").delegate(".fo-historyBtn","click",function(){{var b=$.trim($(this).attr("data-winWidth")),c=$.trim($(this).attr("data-winHeight")),d="/historyFile";new e({width:b,height:c}).openIframe(d+"?t="+(new Date).getMilliseconds(),function(b){$("body").delegate(a,"click",function(){b.close()})})}})}}),define("app/common/table",["gallery/jquery/jquery-1.10.2.min.js"],function(a,b){a("gallery/jquery/jquery-1.10.2.min.js"),b.list=function(){c()};var c=function(){$("body").delegate(".t-table-item","mouseover",function(){$(this).addClass("selected")}).delegate(".t-table-item","mouseout",function(){$(this).removeClass("selected")})}}),define("app/common/loading",["gallery/jquery/jquery-1.10.2.min.js"],function(a,b,c){a("gallery/jquery/jquery-1.10.2.min.js");var d=function(a,b,c,d){var e=a.attr("data-height");a.css({position:"relative"}),a.height(e),a.html("<img src='/images/blui/loading.gif' style='position:absolute;top:50%;margin-top:-32px;left:50%;margin-left:-32px;'/>"),a.load(b,c,function(b){"function"==typeof d&&(a.height("auto"),d(b,a))})};c.exports=d});
